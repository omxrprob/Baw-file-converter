<!DOCTYPE html>
<html>
<head>
  <title>.bawi Converter</title>
</head>
<body>
  <h1>.bawi Converter</h1>
  <input type="file" id="imageInput" accept="image/*"><br><br>
  <label for="threshold">Threshold (0â€“255):</label>
  <input type="number" id="threshold" value="128" min="0" max="255"><br><br>
  <button onclick="convertToBawi()">Convert</button>

  <script>
    function convertToBawi() {
      const input = document.getElementById('imageInput').files[0];
      const threshold = parseInt(document.getElementById('threshold').value);

      if (!input) {
        alert("Upload an image first.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          const imageData = ctx.getImageData(0, 0, img.width, img.height);
          const pixels = imageData.data;
          let data = `BAWIv1\nWIDTH=${img.width}\nHEIGHT=${img.height}\nDATA=\n`;

          for (let y = 0; y < img.height; y++) {
            let row = '';
            for (let x = 0; x < img.width; x++) {
              const i = (y * img.width + x) * 4;
              const r = pixels[i];
              const g = pixels[i + 1];
              const b = pixels[i + 2];
              const avg = (r + g + b) / 3;
              row += avg > threshold ? '1' : '0';
            }
            data += row + '\n';
          }

          const blob = new Blob([data], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = input.name.replace(/\.[^/.]+$/, "") + ".bawi";
          a.click();
          URL.revokeObjectURL(url);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(input);
    }
  </script>
</body>
</html>
