<!DOCTYPE html>
<html>
<head>
  <title>.bawi Converter</title>
</head>
<body>
  <h1>.bawi Converter (Black and White Image)</h1>

  <input type="file" id="imageInput" accept="image/*"><br><br>

  <label for="threshold">Threshold (0â€“255):</label>
  <input type="number" id="threshold" value="128" min="0" max="255"><br><br>

  <button onclick="convertToBawi()">Convert and Preview</button><br><br>

  <canvas id="previewCanvas"></canvas><br><br>

  <script>
    function convertToBawi() {
      const input = document.getElementById('imageInput').files[0];
      const threshold = parseInt(document.getElementById('threshold').value);
      const previewCanvas = document.getElementById('previewCanvas');
      const ctx = previewCanvas.getContext('2d');

      if (!input) {
        alert("Upload an image first.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          previewCanvas.width = img.width;
          previewCanvas.height = img.height;
          ctx.drawImage(img, 0, 0);
          const imageData = ctx.getImageData(0, 0, img.width, img.height);
          const pixels = imageData.data;

          // Convert to black and white in the imageData
          for (let i = 0; i < pixels.length; i += 4) {
            const avg = (pixels[i] + pixels[i + 1] + pixels[i + 2]) / 3;
            const value = avg > threshold ? 255 : 0;
            pixels[i] = pixels[i + 1] = pixels[i + 2] = value;
          }

          ctx.putImageData(imageData, 0, 0); // update preview

          // Generate .bawi file text
          let data = `BAWIv1\nWIDTH=${img.width}\nHEIGHT=${img.height}\nDATA=\n`;
          for (let y = 0; y < img.height; y++) {
            let row = '';
            for (let x = 0; x < img.width; x++) {
              const i = (y * img.width + x) * 4;
              const r = pixels[i]; // already thresholded
              row += r === 255 ? '1' : '0';
            }
            data += row + '\n';
          }

          // Trigger download
          const blob = new Blob([data], { type: 'text/plain' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = input.name.replace(/\.[^/.]+$/, "") + ".bawi";
          a.click();
          URL.revokeObjectURL(url);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(input);
    }
  </script>
</body>
</html>
